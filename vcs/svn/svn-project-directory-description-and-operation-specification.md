# 项目目录说明 & 操作规范

## 开发方式

    主干发布 分支开发

## 命名规范

    trunk                                               主干-【用于发布正式服】
    tags/                                               tags-【用于历史版本记录】
    tags/release-1.0.0[.svnVerNo-201610011201].tgz      1.0.0版
    branches/                                           分支目录
    branches/test                                       测试分支-【用于发布测试服】
    branches/feature-xxx                                新特性/功能分支
    branches/bugfix-xxx                                 问题修复分支
    branches/optimize-xxx                               优化分支
    branches/refacter-xxx                               重构分支

    branches/dev-v1.2.3                                 1.2.3版本开发分支
    branches/dev-v1.2.3-feature-xxx                     1.2.3版本xxx特性开发分支

## 项目路径说明

    trunk - 项目主干，用于项目代码发布，此路径下的代码是线上运行代码，所以此目录下的代码应该是经过完整测试的健壮代码。

    tags - 此目录下的文件用于历史版本记录，一般情况下，每次发布的版本都应该在此目录下，但是由于服务端直接上线，加上版本不清晰，所以这个一般未使用。

    branches - 目录下为各功能开发分支及测试分支，主要有新特性、优化、重构、测试等分支。

## 操作规范

基本步骤：

1. 创建基本的主干分支目录结构。
1. 搭建基础项目框架，从主干创建开发分支，完成之后合并到主干分支，此步骤需要书写`CHANGELOG.md`，记录变更内容，并提交代码。
1. 从主干创建功能开发分支，进行功能开发，完成之后，讲修改后的内容合并到测试分支，进行功能测试，测试完成之后，由开发分支直接合并到发布分支（trunk），同样，需要书写`CHANGELOG.md`，记录变更内容，并提交代码。

注意事项：

* 前期开发没有发布的情况下，可以直接从开发分支合并到主干，或者也可直接在主干上进行开发。最好开始就做好发布部署工作。
* 每个开发分支同时只开发一个功能，分支合并到正式服之后，尽快删除，避免分支太多。
* 各开发分支不断从主干合并代码到开发分支，如果有冲突，使用主干解决冲突，开发分支始终与主干保持一致。
    例如：feature-A/B分支分别开发A/B功能，分支A开发完成之后合并到主干，B合并到主干时，与A分支修改的内容冲突，导致主干冲突，因为修改内容很多，冲突解决非常麻烦，非常容易出错。
    与主干持续合并可以，可以尽早发现冲突，并且将冲突在开发分支上解决，避免不必要的问题。

### 冲突解决

[tsvn-dug-conflicts](https://tortoisesvn.net/docs/nightly/TortoiseSVN_zh_CN/tsvn-dug-conflicts.html)

#### 文件冲突

当两名(或更多)开发人员修改了同一个文件中相邻或相同的行时就会发生文件冲突。

每一个冲突的文件会在目录下产生3个新文件

文件名|内容
-----|-----
文件名.扩展名.mine | 这是你的文件，在你更新你的工作副本之前存在于你的的工作副本中——也就是说，没有冲突标志。这个文件除了你的最新修改外没有别的东西。
文件名.扩展名.r旧版本 | 这是在你更新你的工作副本之前的基础版本(BASE revision)文件。也就是说，它是在你做最后修改之前所检出的文件。
文件名.扩展名.r新版本 | 这个文件是当你更新你的工作副本时，你的 Subversion 客户端从服务器接收到的。这个文件对应于版本库中的最新版本。

然后，执行命令 *TortoiseSVN → 已解决* 并提交人的修改到版本库。需要注意的是*已解决命令并不是真正的解决了冲突*，它只是删除了文件 *文件名.扩展名.mine* 和 *文件名.扩展名.r*，允许你提交修改。

如果你的二进制文件有冲突，Subversion不会试图合并文件。本地文件保持不变(完全是你最后修改时的样子)，但你会看到文件名.扩展名.r*文件。

如果你要撤消你的修改，保留版本库中的版本，请使用 *SVN 还原(Revert)命令*。如果你要保持你的版本覆盖版本库中的版本，使用*已解决*命令，然后提交你的版本。

你可以右击父文件夹，选择*TortoiseSVN → 已解决...*，使用*“已解决”*命令来解决多个文件。这个操作会出现一个对话框，列出文件夹下所有有冲突的文件，你可以选择将哪些标记成已解决。


#### 属性冲突

当两名或更多的开发人员修改了某个文件的属性时就会发生属性冲突。属性作为文件的一部分，解决属性冲突只能由开发人员来完成。

如果一个更改必须被另一个覆盖，那么就在 *使用本地属性解决* 和 *使用远程属性解决* 中选择一个。如果更改想要被合并，那就选择 手工编辑属性，选出所要的属性值然后标记为已解决。

#### 树冲突

当一名开发人员移动、重命名、删除一个文件或文件夹，而另一名开发人员也对它们进行了移动、重命名、删除或者仅仅是修改时就会发生树冲突。

当一个文件通过 Subversion 在本机删除后，文件也从本机文件系统中删除。因此即使它是树冲突的一部分，却既不能显示冲突的叠加图标也不能通过右键单击来解决冲突。使用*检查修改*对话框来获得*编辑冲突选项*。

TortoiseSVN 能够协助找到合并更改的正确位置，但是需要作一些额外的工作来整理冲突。

请牢记: 当进行一次更新操作后，工作副本的基础文件将会包括每一个项目在执行更新操作时版本库中的版本。如果你在进行更新后再撤销更改，工作副本将返回到版本库的状态，而不是你开始进行更改前的状态。

##### 更新时冲突：删除+更改，删除+删除，更改+删除

* 本地删除，当更新时有更改进入
* 本地删除，当更新时有删除进入
* 本地更改，当更新时有删除进入

##### 合并时冲突：缺少+更改，更改+删除，删除+删除

* 本地缺少，当合并时有更改进入
* 本地更改，当合并时有删除进入
* 本地删除，当合并时有删除进入

从上面的主要情形可以看出，树冲突主要是由*删除（本地删除、重命名）*文件导致的，所以在开发过程中应该避免*删除*和*重命名*操作。如果需要删除或重命名文件，应该确保该文件不会在其他分支上修改，甚至是单独处理*删除*和*重命名*。

谨慎的创建和删除文件，使用合适的文件名，是避免冲突的有力手段。

前端文件如果进行版本化，则在每一次重新构建时会*删除旧版本的文件*，生成*新的版本的文件*，这样在合并的时候非常容易冲突。一种好的处理方式是：本地不进行提交打包文件，服务器上自动对前端文件进行打包操作。

在合并时发生冲突的时，如果标记为*已解决*，在下次合并的时候，刚刚*冲突的文件*将会被忽略掉，不会再合并过来，这个时候是很难发现的。解决方式是直接复制合并源的代码到待合并的目录下覆盖，查看有无需要提交的文件。

